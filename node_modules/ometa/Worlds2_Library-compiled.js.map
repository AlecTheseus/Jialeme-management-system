{"version":3,"sources":["Worlds2_Library.js"],"names":[],"mappings":";;;AAEA,QAAQ,KAAR;;AAOA,CAAC,YAAW;AACV,MAAI,SAAS,CAAb;AAAA,MAAgB,WAAW,EAA3B;AACA,MAAI,UAAU,SAAV,OAAU,CAAS,CAAT,EAAY;AACxB,QAAI,MAAM,IAAN,IAAc,MAAM,SAAxB,EACE,OAAO,CAAP;AACF,mBAAe,CAAf,yCAAe,CAAf;AACE,WAAK,SAAL;AAAgB,eAAO,KAAK,IAAL,GAAY,OAAZ,GAAsB,QAA7B;AAChB,WAAK,QAAL;AAAgB,eAAO,MAAM,CAAb;AAChB,WAAK,QAAL;AAAgB,eAAO,MAAM,CAAb;AAChB;AAAgB,eAAO,EAAE,cAAF,CAAiB,MAAjB,IAA2B,EAAE,IAA7B,GAAoC,EAAE,IAAF,GAAS,MAAM,QAA1D;AAJlB;AAMD,GATD;AAUA,WAAS,gBAAS,CAAT,EAAY;AACnB,QAAI,MAAM,QAAQ,CAAR,CAAV;AACA,aAAS,GAAT,IAAgB,CAAhB;AACA,WAAO,GAAP;AACD,GAJD;AAKA,WAAS,gBAAS,CAAT,EAAY;AACnB,WAAO,SAAS,CAAT,CAAP;AACD,GAFD;AAGD,CApBD;;AAwBA,aAAa,EAAb;;AAEA,YAAY,YAAa,YAAW;AAClC,MAAI,SAAS,EAAb;AACA,SAAO;AACL,YAAQ,UADH;AAEL,YAAQ,MAFH;AAGL,YAAQ,gBAAS,CAAT,EAAY,CAAZ,EAAe;AACrB,UAAI,KAAK,OAAO,CAAP,CAAT;AACA,aAAO,OAAO,cAAP,CAAsB,EAAtB,KAA6B,OAAO,EAAP,EAAW,cAAX,CAA0B,CAA1B,CAApC;AACD,KANI;AAOL,SAAK,aAAS,CAAT,EAAY,CAAZ,EAAe;AAClB,aAAO,KAAK,MAAL,CAAY,CAAZ,EAAe,CAAf,KACA,MAAM,OAAO,SAAb,IAA0B,KAAK,GAAL,CAAS,MAAM,IAAN,IAAc,MAAM,SAApB,GAAgC,OAAO,SAAvC,GAAmD,EAAE,MAA9D,EAAsE,CAAtE,CADjC;AAED,KAVI;AAWL,WAAO,eAAS,CAAT,EAAY,EAAZ,EAAgB;AACrB,UAAI,KAAK,OAAO,CAAP,CAAT;AACA,UAAI,OAAO,cAAP,CAAsB,EAAtB,CAAJ,EACE,KAAK,IAAI,CAAT,IAAc,OAAO,EAAP,CAAd;AACE,YAAI,OAAO,EAAP,EAAW,cAAX,CAA0B,CAA1B,CAAJ,EACE,GAAG,CAAH,IAAQ,IAAR;AAFJ,OAGF,IAAI,MAAM,OAAO,SAAjB,EACE,KAAK,KAAL,CAAW,MAAM,IAAN,IAAc,MAAM,SAApB,GAAgC,OAAO,SAAvC,GAAmD,EAAE,MAAhE,EAAwE,EAAxE;AACF,aAAO,EAAP;AACD,KApBI;AAqBL,UAAM,cAAS,CAAT,EAAY,CAAZ,EAAe;AACnB,UAAI,KAAK,OAAO,CAAP,CAAT;AACA,UAAI,KAAJ,EAAW,QAAQ,GAAR,CAAY,kCAAkC,EAAlC,GAAuC,GAAvC,GAA6C,CAAzD;AACX,UAAI,OAAO,cAAP,CAAsB,EAAtB,KAA6B,OAAO,EAAP,EAAW,cAAX,CAA0B,CAA1B,CAAjC,EACE,OAAO,OAAO,EAAP,EAAW,CAAX,CAAP,CADF,KAEK,IAAI,MAAM,OAAO,SAAjB,EACH,OAAO,UAAU,IAAV,CAAe,MAAM,IAAN,IAAc,MAAM,SAApB,GAAgC,OAAO,SAAvC,GAAmD,EAAE,MAApE,EAA4E,CAA5E,CAAP,CADG,KAGH,OAAO,SAAP;AACH,KA9BI;AA+BL,SAAK,aAAS,CAAT,EAAY,CAAZ,EAAe;AAElB,UAAI,OAAO,CAAP,KAAa,QAAb,KAA0B,OAAO,CAAP,KAAa,QAAb,IAAyB,MAAM,QAAzD,CAAJ,EACE,OAAO,EAAE,CAAF,CAAP,CADF,KAGE,OAAO,KAAK,IAAL,CAAU,CAAV,EAAa,CAAb,CAAP;AACH,KArCI;AAsCL,SAAK,aAAS,CAAT,EAAY,CAAZ,EAAe,CAAf,EAAkB;AACrB,UAAI,OAAO,CAAP,KAAa,QAAb,KAA0B,OAAO,CAAP,KAAa,QAAb,IAAyB,MAAM,QAAzD,CAAJ,EACE,MAAM,iFAAN;AACF,UAAI,KAAK,OAAO,CAAP,CAAT;AACA,UAAI,KAAJ,EAAW,QAAQ,GAAR,CAAY,oCAAoC,EAApC,GAAyC,GAAzC,GAA+C,CAA3D;AACX,UAAI,CAAC,OAAO,cAAP,CAAsB,EAAtB,CAAL,EACE,OAAO,EAAP,IAAa,EAAb;AACF,aAAO,EAAP,EAAW,CAAX,IAAgB,CAAhB;AACA,aAAO,CAAP;AACD,KA/CI;AAgDL,YAAQ,kBAAW,CAAG,CAhDjB;AAiDL,YAAQ,kBAAW;AACjB,UAAI,cAAc,IAAlB;AAAA,UAAwB,SAAS,EAAjC;AAAA,UAAqC,QAAQ,EAA7C;AACA,aAAO;AACL,gBAAQ,UADH;AAEL,gBAAQ,MAFH;AAGL,eAAQ,KAHH;AAIL,gBAAQ,gBAAS,CAAT,EAAY,CAAZ,EAAe;AACrB,cAAI,KAAK,OAAO,CAAP,CAAT;AACA,iBAAO,OAAO,cAAP,CAAsB,EAAtB,KAA6B,OAAO,EAAP,EAAW,cAAX,CAA0B,CAA1B,CAA7B,IACA,MAAM,cAAN,CAAqB,EAArB,KAA6B,MAAM,EAAN,EAAU,cAAV,CAAyB,CAAzB,CAD7B,IAEA,YAAY,MAAZ,CAAmB,CAAnB,EAAsB,CAAtB,CAFP;AAGD,SATI;AAUL,aAAK,aAAS,CAAT,EAAY,CAAZ,EAAe;AAClB,iBAAO,KAAK,MAAL,CAAY,CAAZ,EAAe,CAAf,KACA,MAAM,OAAO,SAAb,IAA0B,KAAK,GAAL,CAAS,MAAM,IAAN,IAAc,MAAM,SAApB,GAAgC,OAAO,SAAvC,GAAmD,EAAE,MAA9D,EAAsE,CAAtE,CADjC;AAED,SAbI;AAcL,eAAO,eAAS,CAAT,EAAY,EAAZ,EAAgB;AACrB,cAAI,KAAK,OAAO,CAAP,CAAT;AACA,cAAI,OAAO,cAAP,CAAsB,EAAtB,CAAJ,EACE,KAAK,IAAI,CAAT,IAAc,OAAO,EAAP,CAAd;AACE,gBAAI,OAAO,EAAP,EAAW,cAAX,CAA0B,CAA1B,CAAJ,EACE,GAAG,CAAH,IAAQ,IAAR;AAFJ,WAGF,IAAI,MAAM,cAAN,CAAqB,EAArB,CAAJ,EACE,KAAK,IAAI,CAAT,IAAc,MAAM,EAAN,CAAd;AACE,gBAAI,MAAM,EAAN,EAAU,cAAV,CAAyB,CAAzB,CAAJ,EACE,GAAG,CAAH,IAAQ,IAAR;AAFJ,WAGF,IAAI,MAAM,OAAO,SAAjB,EACE,KAAK,KAAL,CAAW,MAAM,IAAN,IAAc,MAAM,SAApB,GAAgC,OAAO,SAAvC,GAAmD,EAAE,MAAhE,EAAwE,EAAxE;AACF,sBAAY,KAAZ,CAAkB,CAAlB,EAAqB,EAArB;AACA,iBAAO,EAAP;AACD,SA5BI;AA6BL,cAAM,cAAS,CAAT,EAAY,CAAZ,EAAe;AACnB,cAAI,KAAK,OAAO,CAAP,CAAT;AACA,cAAI,KAAJ,EAAW,QAAQ,GAAR,CAAY,8BAA8B,EAA9B,GAAmC,GAAnC,GAAyC,CAArD;AACX,cAAS,OAAO,cAAP,CAAsB,EAAtB,KAA6B,OAAO,EAAP,EAAW,cAAX,CAA0B,CAA1B,CAAtC,EACE,OAAO,OAAO,EAAP,EAAW,CAAX,CAAP,CADF,KAEK,IAAI,MAAM,cAAN,CAAqB,EAArB,KAA6B,MAAM,EAAN,EAAU,cAAV,CAAyB,CAAzB,CAAjC,EACH,OAAO,MAAM,EAAN,EAAU,CAAV,CAAP,CADG,KAGH,OAAO,YAAY,IAAZ,CAAiB,CAAjB,EAAoB,CAApB,CAAP;AACH,SAtCI;AAuCL,aAAK,aAAS,CAAT,EAAY,CAAZ,EAAe;AAClB,cAAI,OAAO,CAAP,KAAa,QAAb,KAA0B,OAAO,CAAP,KAAa,QAAb,IAAyB,MAAM,QAAzD,CAAJ,EACE,OAAO,EAAE,CAAF,CAAP;AACF,cAAI,KAAK,OAAO,CAAP,CAAT;AAAA,cAAoB,MAAM,KAAK,IAAL,CAAU,CAAV,EAAa,CAAb,CAA1B;AACA,cAAI,CAAC,MAAM,cAAN,CAAqB,EAArB,CAAL,EAA+B;AAC7B,kBAAM,EAAN,IAAY,EAAZ;AACA,gBAAI,CAAC,MAAM,EAAN,EAAU,cAAV,CAAyB,CAAzB,CAAL,EACE,MAAM,EAAN,EAAU,CAAV,IAAe,GAAf;AACH;AACD,iBAAO,GAAP;AACD,SAjDI;AAkDL,aAAK,aAAS,CAAT,EAAY,CAAZ,EAAe,CAAf,EAAkB;AACrB,cAAI,OAAO,CAAP,KAAa,QAAb,KAA0B,OAAO,CAAP,KAAa,QAAb,IAAyB,MAAM,QAAzD,CAAJ,EACE,MAAM,iFAAN;AACF,cAAI,KAAK,OAAO,CAAP,CAAT;AACA,cAAI,KAAJ,EAAW,QAAQ,GAAR,CAAY,gCAAgC,EAAhC,GAAqC,GAArC,GAA2C,CAAvD;AACX,cAAI,CAAC,OAAO,cAAP,CAAsB,EAAtB,CAAL,EACE,OAAO,EAAP,IAAa,EAAb;AACF,iBAAO,EAAP,EAAW,CAAX,IAAgB,CAAhB;AACA,iBAAO,CAAP;AACD,SA3DI;AA4DL,gBAAQ,kBAAW;AAEjB,eAAK,IAAI,EAAT,IAAe,KAAf,EAAsB;AACpB,gBAAI,CAAC,MAAM,cAAN,CAAqB,EAArB,CAAL,EACE;AACF,iBAAK,IAAI,CAAT,IAAc,MAAM,EAAN,CAAd,EAAyB;AACvB,kBAAI,CAAC,MAAM,EAAN,EAAU,cAAV,CAAyB,CAAzB,CAAL,EACE,SADF,KAEK,IAAI,MAAM,EAAN,EAAU,CAAV,MAAiB,YAAY,IAAZ,CAAiB,OAAO,EAAP,CAAjB,EAA6B,CAA7B,CAArB,EACH,MAAM,eAAN;AACH;AACF;;AAED,eAAK,IAAI,EAAT,IAAe,MAAf,EAAuB;AACrB,gBAAI,CAAC,OAAO,cAAP,CAAsB,EAAtB,CAAL,EACE;AACF,iBAAK,IAAI,CAAT,IAAc,OAAO,EAAP,CAAd,EAA0B;AACxB,kBAAI,CAAC,OAAO,EAAP,EAAW,cAAX,CAA0B,CAA1B,CAAL,EACE;AACF,kBAAI,CAAC,YAAY,MAAZ,CAAmB,cAAnB,CAAkC,EAAlC,CAAL,EACE,YAAY,MAAZ,CAAmB,EAAnB,IAAyB,EAAzB;AACF,kBAAI,KAAJ,EAAW,QAAQ,GAAR,CAAY,gBAAgB,EAAhB,GAAqB,GAArB,GAA2B,CAAvC;AACX,0BAAY,MAAZ,CAAmB,EAAnB,EAAuB,CAAvB,IAA4B,OAAO,EAAP,EAAW,CAAX,CAA5B;AACD;AACF;AACD,mBAAS,EAAT;AACA,kBAAS,EAAT;AACD,SAvFI;AAwFL,gBAAQ,YAAY;AAxFf,OAAP;AA0FD;AA7II,GAAP;AA+ID,CAjJuB,EAAxB;AAkJA,aAAa,CAAC,SAAD,CAAb;;AAIA,cAAc,uBAAW,CAAG,CAA5B;AACA,YAAY,SAAZ,GAAwB;AACtB,UAAW,OAAO,SADI;AAEtB,UAAW,gBAAS,CAAT,EAAe;AAAE,WAAO,UAAU,MAAV,CAAiB,IAAjB,EAAuB,CAAvB,CAAP;AAAmC,GAFzC;AAGtB,OAAW,aAAS,CAAT,EAAe;AAAE,WAAO,UAAU,GAAV,CAAc,IAAd,EAAoB,CAApB,CAAP;AAAmC,GAHzC;AAItB,OAAW,aAAS,CAAT,EAAe;AAAE,WAAO,UAAU,GAAV,CAAc,IAAd,EAAoB,CAApB,CAAP;AAAmC,GAJzC;AAKtB,OAAW,aAAS,CAAT,EAAY,CAAZ,EAAe;AAAE,WAAO,UAAU,GAAV,CAAc,IAAd,EAAoB,CAApB,EAAuB,CAAvB,CAAP;AAAmC,GALzC;AAMtB,QAAW,cAAS,CAAT,EAAY,CAAZ,EAAe;AAAE,WAAO,UAAU,GAAV,CAAc,IAAd,EAAoB,CAApB,EAAuB,CAAvB,CAAP;AAAmC,GANzC;AAOtB,aAAW,qBAAe;AAAE,WAAO,IAAI,gBAAJ,CAAqB,IAArB,CAAP;AAAmC;AAPzC,CAAxB;;AAUA,mBAAmB,0BAAS,MAAT,EAAiB;AAAE,OAAK,MAAL,GAAc,MAAd;AAAsB,CAA5D;AACA,iBAAiB,SAAjB,GAA6B,IAAI,WAAJ,EAA7B;AACA,iBAAiB,SAAjB,CAA2B,GAA3B,GAAiC,UAAS,CAAT,EAAe;AAAE,SAAO,UAAU,GAAV,CAAc,IAAd,EAAoB,CAApB,IACE,UAAU,GAAV,CAAc,IAAd,EAAoB,CAApB,CADF,GAEE,KAAK,MAAL,CAAY,GAAZ,CAAgB,CAAhB,CAFT;AAEsC,CAFxF;AAGA,iBAAiB,SAAjB,CAA2B,GAA3B,GAAiC,UAAS,CAAT,EAAY,CAAZ,EAAe;AAAE,SAAO,UAAU,GAAV,CAAc,IAAd,EAAoB,CAApB,IACE,UAAU,GAAV,CAAc,IAAd,EAAoB,CAApB,EAAuB,CAAvB,CADF,GAEE,KAAK,MAAL,CAAY,GAAZ,CAAgB,CAAhB,EAAmB,CAAnB,CAFT;AAEsC,CAFxF;;AAIA,YAAY,IAAI,WAAJ,EAAZ;;AAIA,OAAO,cAAS,GAAT,EAAc,IAAd,EAAoB,IAApB,EAA0B;AAE/B,SAAO,UAAU,GAAV,CAAc,IAAd,EAAoB,GAApB,EAAyB,KAAzB,CAA+B,IAA/B,EAAqC,IAArC,CAAP;AACD,CAHD;;AAOA,SAAS,SAAT,CAAmB,SAAnB,GAA+B,YAAW;AACxC,MAAI,IAAI,EAAC,QAAQ,UAAU,GAAV,CAAc,IAAd,EAAoB,WAApB,CAAT,EAAR;AACA,OAAK,KAAL,CAAW,CAAX,EAAc,SAAd;AACA,SAAO,CAAP;AACD,CAJD;;AAQA,aAAa,oBAAS,CAAT,EAAY,CAAZ,EAAe;AAC1B,MAAI,IAAI,EAAE,MAAV;AAAA,MAAkB,KAAK,UAAU,GAAV,CAAc,CAAd,EAAiB,WAAjB,CAAvB;AACA,SAAO,KAAK,SAAZ,EAAuB;AACrB,QAAI,KAAK,EAAT,EACE,OAAO,IAAP;AACF,QAAI,EAAE,MAAN;AACD;AACD,SAAO,KAAP;AACD,CARD;;AAYA,UAAW,mBAAW,CAAG,CAAzB;AACA,UAAU,IAAV,CAAe,QAAf,EAA0B,OAA1B;AACA,UAAU,GAAV,CAAc,OAAd,EAAuB,WAAvB,EAAoC,OAAO,SAA3C;AACA,UAAU,GAAV,CAAc,OAAO,SAArB,EAAgC,QAAhC,EAA0C,UAAS,CAAT,EAAY;AAAE,SAAO,UAAU,GAAV,CAAc,IAAd,EAAoB,CAApB,CAAP;AAA+B,CAAvF;AACA,UAAU,GAAV,CAAc,OAAO,SAArB,EAAgC,UAAhC,EAA4C,YAAW;AAAE,SAAO,KAAK,IAAZ;AAAkB,CAA3E;;AAEA,UAAU,GAAV,CAAc,UAAd,EAA0B,QAA1B,EAAsC,YAAW;AAAE,SAAO,KAAK,MAAL,EAAP;AAAwC,CAA3F;AACA,UAAU,GAAV,CAAc,UAAd,EAA0B,QAA1B,EAAsC,YAAW;AAAE,SAAO,KAAK,MAAL,EAAP;AAAwC,CAA3F;AACA,UAAU,GAAV,CAAc,UAAd,EAA0B,UAA1B,EAAsC,YAAW;AAAE,SAAO,YAAY,KAAK,MAAL,EAAZ,GAA4B,GAAnC;AAAwC,CAA3F;;AAEA,SAAY,kBAAW,CAAG,CAA1B,CAA4B,UAAU,IAAV,CAAe,OAAf,EAA2B,MAA3B,EAAuC,UAAU,GAAV,CAAc,MAAd,EAAyB,WAAzB,EAAsC,UAAtC;AACnE,WAAY,oBAAW,CAAG,CAA1B,CAA4B,UAAU,IAAV,CAAe,SAAf,EAA2B,QAA3B,EAAuC,UAAU,GAAV,CAAc,QAAd,EAAyB,WAAzB,EAAsC,EAAC,QAAQ,OAAO,SAAhB,EAAtC;AACnE,UAAY,mBAAW,CAAG,CAA1B,CAA4B,UAAU,IAAV,CAAe,QAAf,EAA2B,OAA3B,EAAuC,UAAU,GAAV,CAAc,OAAd,EAAyB,WAAzB,EAAsC,EAAC,QAAQ,OAAO,SAAhB,EAAtC;AACnE,UAAY,mBAAW,CAAG,CAA1B,CAA4B,UAAU,IAAV,CAAe,QAAf,EAA2B,OAA3B,EAAuC,UAAU,GAAV,CAAc,OAAd,EAAyB,WAAzB,EAAsC,EAAC,QAAQ,OAAO,SAAhB,EAAtC;AACnE,SAAY,kBAAW,CAAG,CAA1B,CAA4B,UAAU,IAAV,CAAe,OAAf,EAA2B,MAA3B,EAAuC,UAAU,GAAV,CAAc,MAAd,EAAyB,WAAzB,EAAsC,EAAC,QAAQ,OAAO,SAAhB,EAAtC;AACnE,YAAY,qBAAW,CAAG,CAA1B,CAA4B,UAAU,IAAV,CAAe,UAAf,EAA2B,SAA3B,EAAuC,UAAU,GAAV,CAAc,SAAd,EAAyB,WAAzB,EAAsC,EAAC,QAAQ,OAAO,SAAhB,EAAtC;;AAEnE,QAAQ,SAAR,CAAkB,MAAlB,GAA6B,UAAU,GAAV,CAAc,QAAd,EAA0B,WAA1B,CAA7B;AACA,OAAO,SAAP,CAAiB,MAAjB,GAA6B,UAAU,GAAV,CAAc,OAAd,EAA0B,WAA1B,CAA7B;AACA,OAAO,SAAP,CAAiB,MAAjB,GAA6B,UAAU,GAAV,CAAc,OAAd,EAA0B,WAA1B,CAA7B;AACA,SAAS,SAAT,CAAmB,MAAnB,GAA6B,UAAU,GAAV,CAAc,SAAd,EAA0B,WAA1B,CAA7B;;;AAGA,UAAU,GAAV,CAAc,OAAd,EAAuB,cAAvB,EAAuC,UAAS,CAAT,EAAY;AAAE,SAAO,OAAO,YAAP,CAAoB,CAApB,CAAP;AAA+B,CAApF;AACA,UAAU,GAAV,CAAc,OAAO,SAAP,CAAiB,MAA/B,EAAuC,YAAvC,EAAqD,UAAS,CAAT,EAAY;AAAE,SAAO,KAAK,UAAL,CAAgB,CAAhB,CAAP;AAA2B,CAA9F;;AAEA,UAAU,GAAV,CAAc,SAAS,SAAT,CAAmB,MAAjC,EAAyC,OAAzC,EAAkD,UAAS,IAAT,EAAe,IAAf,EAAqB;AACrE,MAAI,MAAJ;AACA,MAAI,QAAQ,UAAU,GAAV,CAAc,IAAd,EAAoB,QAApB,IAAgC,CAA5C,EAA+C;AAC7C,aAAS,EAAT;AACA,SAAK,IAAI,MAAM,CAAf,EAAkB,MAAM,UAAU,GAAV,CAAc,IAAd,EAAoB,QAApB,CAAxB,EAAuD,KAAvD;AACE,aAAO,IAAP,CAAY,UAAU,GAAV,CAAc,IAAd,EAAoB,GAApB,CAAZ;AADF;AAED;AACD,SAAO,KAAK,KAAL,CAAW,IAAX,EAAiB,MAAjB,CAAP;AACD,CARD;AASA,UAAU,GAAV,CAAc,SAAS,SAAT,CAAmB,MAAjC,EAAyC,MAAzC,EAAiD,UAAS,IAAT,EAAe;AAC9D,MAAI,SAAS,EAAb;AACA,OAAK,IAAI,MAAM,CAAf,EAAkB,MAAM,UAAU,MAAlC,EAA0C,KAA1C;AACE,WAAO,IAAP,CAAY,UAAU,GAAV,CAAZ;AADF,GAEA,OAAO,KAAK,KAAL,CAAW,IAAX,EAAiB,MAAjB,CAAP;AACD,CALD;;AAOA,UAAU,IAAV,CAAe,MAAf,EAA4B,IAA5B;AACA,UAAU,IAAV,CAAe,WAAf,EAA4B,SAA5B;AACA,UAAU,IAAV,CAAe,MAAf,EAA4B,IAA5B;AACA,UAAU,IAAV,CAAe,OAAf,EAA4B,KAA5B;;AAEA,UAAU,IAAV,CAAe,QAAf,EAA0B,UAAS,CAAT,EAAY;AAAE,SAAO,KAAK,UAAU,GAAV,CAAc,CAAd,EAAiB,UAAjB,EAA6B,IAA7B,CAAkC,CAAlC,CAAL,CAAP;AAAsD,CAA9F;AACA,UAAU,IAAV,CAAe,OAAf,EAA0B,UAAS,CAAT,EAAY;AAAE,QAAM,UAAU,GAAV,CAAc,CAAd,EAAiB,UAAjB,EAA6B,IAA7B,CAAkC,CAAlC,CAAN;AAAsD,CAA9F;AACA,UAAU,IAAV,CAAe,OAAf,EAA0B,UAAS,CAAT,EAAY;AAAE,QAAM,UAAU,GAAV,CAAc,CAAd,EAAiB,UAAjB,EAA6B,IAA7B,CAAkC,CAAlC,CAAN;AAAsD,CAA9F;AACA,UAAU,IAAV,CAAe,QAAf,EAA0B,UAAS,CAAT,EAAY;AAAE,SAAO,OAAO,UAAU,GAAV,CAAc,CAAd,EAAiB,UAAjB,EAA6B,IAA7B,CAAkC,CAAlC,CAAP,CAAP;AAAsD,CAA9F;AACA,UAAU,IAAV,CAAe,SAAf,EAA0B,UAAS,CAAT,EAAY;AAAE,SAAO,QAAQ,UAAU,GAAV,CAAc,CAAd,EAAiB,UAAjB,EAA6B,IAA7B,CAAkC,CAAlC,CAAR,CAAP;AAAsD,CAA9F;;AAEA,UAAU,IAAV,CAAe,UAAf,EAA6B,UAAS,CAAT,EAAY;AAAE,SAAO,SAAS,CAAT,CAAP;AAAsB,CAAjE;AACA,UAAU,IAAV,CAAe,YAAf,EAA6B,UAAS,CAAT,EAAY;AAAE,SAAO,WAAW,CAAX,CAAP;AAAsB,CAAjE;;AAEA,gBAAgB,EAAhB;AACA,UAAU,IAAV,CAAe,SAAf,EAA0B,aAA1B;AACA,UAAU,GAAV,CAAc,aAAd,EAA6B,KAA7B,EAAoC,UAAS,CAAT,EAAY;AAAE,aAAW,IAAX,CAAgB,UAAU,GAAV,CAAc,CAAd,EAAiB,UAAjB,EAA6B,KAA7B,CAAmC,CAAnC,CAAhB;AAAwD,CAA1G;;AAEA,MAAM,SAAN,CAAgB,UAAhB,GAA6B,YAAW;AACtC,MAAI,IAAI,OAAO,SAAP,EAAR;AACA,OAAK,IAAI,MAAM,CAAf,EAAkB,MAAM,KAAK,MAA7B,EAAqC,KAArC;AACE,cAAU,GAAV,CAAc,CAAd,EAAiB,GAAjB,EAAsB,KAAK,GAAL,CAAtB;AADF,GAEA,UAAU,GAAV,CAAc,CAAd,EAAiB,QAAjB,EAA2B,KAAK,MAAhC;AACA,SAAO,CAAP;AACD,CAND;AAOA,OAAO,SAAP,CAAiB,WAAjB,GAA+B,YAAW;AACxC,MAAI,IAAI,QAAQ,SAAR,EAAR;AACA,OAAK,IAAI,CAAT,IAAc,IAAd;AACE,QAAI,KAAK,cAAL,CAAoB,CAApB,CAAJ,EACE,UAAU,GAAV,CAAc,CAAd,EAAiB,CAAjB,EAAoB,KAAK,CAAL,CAApB;AAFJ,GAGA,OAAO,CAAP;AACD,CAND","file":"Worlds2_Library-compiled.js","sourcesContent":["// Copyright (c) 2008, 2010 Alessandro Warth <awarth@cs.ucla.edu>\n\nDEBUG = false;\n\n// getTag: object -> unique id\n// tagToRef: unique id -> object\n\n// Note: this hashing scheme causes a huge memory leak (all b/c JS doesn't support weak references)\n\n(function() {\n  var numIdx = 0, tagToRef = {}\n  var _getTag = function(r) {\n    if (r === null || r === undefined)\n      return r\n    switch (typeof r) {\n      case \"boolean\": return r == true ? \"Btrue\" : \"Bfalse\"\n      case \"string\":  return \"S\" + r\n      case \"number\":  return \"N\" + r\n      default:        return r.hasOwnProperty(\"_id_\") ? r._id_ : r._id_ = \"R\" + numIdx++\n    }\n  }\n  getTag = function(r) {\n    var tag = _getTag(r)\n    tagToRef[tag] = r\n    return tag\n  }\n  getRef = function(t) {\n    return tagToRef[t]\n  }\n})()\n\n// implementation of possible worlds\n\nworldProto = {}\n\nbaseWorld = thisWorld = (function() {\n  var writes = {}\n  return {\n    parent: worldProto,\n    writes: writes,\n    hasOwn: function(r, p) {\n      var id = getTag(r)\n      return writes.hasOwnProperty(id) && writes[id].hasOwnProperty(p)\n    },\n    has: function(r, p) {\n      return this.hasOwn(r, p) ||\n             r !== Object.prototype && this.has(r === null || r === undefined ? Object.prototype : r.parent, p)\n    },\n    props: function(r, ps) {\n      var id = getTag(r)\n      if (writes.hasOwnProperty(id))\n        for (var p in writes[id])\n          if (writes[id].hasOwnProperty(p))\n            ps[p] = true\n      if (r !== Object.prototype)\n        this.props(r === null || r === undefined ? Object.prototype : r.parent, ps)\n      return ps\n    },\n    _get: function(r, p) {\n      var id = getTag(r)\n      if (DEBUG) console.log(\"? top-level world looking up \" + id + \".\" + p)\n      if (writes.hasOwnProperty(id) && writes[id].hasOwnProperty(p))\n        return writes[id][p]\n      else if (r !== Object.prototype)\n        return thisWorld._get(r === null || r === undefined ? Object.prototype : r.parent, p)\n      else\n        return undefined\n    },\n    get: function(r, p) {\n      // the top-level world's commit operation is a no-op, so reads don't have to be recorded\n      if (typeof r === \"string\" && (typeof p === \"number\" || p === \"length\"))\n        return r[p]\n      else\n        return this._get(r, p)\n    },\n    set: function(r, p, v) {\n      if (typeof r === \"string\" && (typeof p === \"number\" || p === \"length\"))\n        throw \"the indices and length of a string are immutable, and you tried to change them!\"\n      var id = getTag(r)\n      if (DEBUG) console.log(\"! top-level world assigning to \" + id + \".\" + p)\n      if (!writes.hasOwnProperty(id))\n        writes[id] = {}\n      writes[id][p] = v\n      return v\n    },\n    commit: function() { },\n    sprout: function() {\n      var parentWorld = this, writes = {}, reads = {}\n      return {\n        parent: worldProto,\n        writes: writes,\n        reads:  reads,\n        hasOwn: function(r, p) {\n          var id = getTag(r)\n          return writes.hasOwnProperty(id) && writes[id].hasOwnProperty(p) ||\n                 reads.hasOwnProperty(id)  && reads[id].hasOwnProperty(p)  ||\n                 parentWorld.hasOwn(r, p)\n        },\n        has: function(r, p) {\n          return this.hasOwn(r, p) ||\n                 r !== Object.prototype && this.has(r === null || r === undefined ? Object.prototype : r.parent, p)\n        },\n        props: function(r, ps) {\n          var id = getTag(r)\n          if (writes.hasOwnProperty(id))\n            for (var p in writes[id])\n              if (writes[id].hasOwnProperty(p))\n                ps[p] = true\n          if (reads.hasOwnProperty(id))\n            for (var p in reads[id])\n              if (reads[id].hasOwnProperty(p))\n                ps[p] = true\n          if (r !== Object.prototype)\n            this.props(r === null || r === undefined ? Object.prototype : r.parent, ps)\n          parentWorld.props(r, ps)\n          return ps\n        },\n        _get: function(r, p) {\n          var id = getTag(r)\n          if (DEBUG) console.log(\"? child world looking up \" + id + \".\" + p)\n          if      (writes.hasOwnProperty(id) && writes[id].hasOwnProperty(p))\n            return writes[id][p]\n          else if (reads.hasOwnProperty(id)  && reads[id].hasOwnProperty(p))\n            return reads[id][p]\n          else\n            return parentWorld._get(r, p)\n        },\n        get: function(r, p) {\n          if (typeof r === \"string\" && (typeof p === \"number\" || p === \"length\"))\n            return r[p]\n          var id = getTag(r), ans = this._get(r, p)\n          if (!reads.hasOwnProperty(id)) {\n            reads[id] = {}\n            if (!reads[id].hasOwnProperty(p))\n              reads[id][p] = ans\n          }\n          return ans\n        },\n        set: function(r, p, v) {\n          if (typeof r === \"string\" && (typeof p === \"number\" || p === \"length\"))\n            throw \"the indices and length of a string are immutable, and you tried to change them!\"\n          var id = getTag(r)\n          if (DEBUG) console.log(\"! child world assigning to \" + id + \".\" + p)\n          if (!writes.hasOwnProperty(id))\n            writes[id] = {}\n          writes[id][p] = v\n          return v\n        },\n        commit: function() {\n          // serializability check\n          for (var id in reads) {\n            if (!reads.hasOwnProperty(id))\n              continue\n            for (var p in reads[id]) {\n              if (!reads[id].hasOwnProperty(p))\n                continue\n              else if (reads[id][p] !== parentWorld._get(getRef(id), p))\n                throw \"commit failed\"\n            }\n          }\n          // propagation of side effects\n          for (var id in writes) {\n            if (!writes.hasOwnProperty(id))\n              continue\n            for (var p in writes[id]) {\n              if (!writes[id].hasOwnProperty(p))\n                continue\n              if (!parentWorld.writes.hasOwnProperty(id))\n                parentWorld.writes[id] = {}\n              if (DEBUG) console.log(\"committing \" + id + \".\" + p)\n              parentWorld.writes[id][p] = writes[id][p]\n            }\n          }\n          writes = {}\n          reads  = {}\n        },\n        sprout: parentWorld.sprout\n      }\n    }\n  }\n})()\nworldStack = [thisWorld]\n\n// Lexical scopes\n\nGlobalScope = function() { }\nGlobalScope.prototype = {\n  parent:    Object.prototype,\n  hasOwn:    function(n)    { return thisWorld.hasOwn(this, n)  },\n  has:       function(n)    { return thisWorld.has(this, n)     },\n  get:       function(n)    { return thisWorld.get(this, n)     },\n  set:       function(n, v) { return thisWorld.set(this, n, v)  },\n  decl:      function(n, v) { return baseWorld.set(this, n, v)  },\n  makeChild: function()     { return new ActivationRecord(this) }\n}\n\nActivationRecord = function(parent) { this.parent = parent }\nActivationRecord.prototype = new GlobalScope()\nActivationRecord.prototype.get = function(n)    { return thisWorld.has(this, n) ?\n                                                           thisWorld.get(this, n) :\n                                                           this.parent.get(n)          }\nActivationRecord.prototype.set = function(n, v) { return thisWorld.has(this, n) ?\n                                                           thisWorld.set(this, n, v) :\n                                                           this.parent.set(n, v)       }\n\nthisScope = new GlobalScope()\n\n// Sends\n\nsend = function(sel, recv, args) {\n  //alert(\"doing a send, sel=\" + sel + \", recv=\" + recv + \", args=\" + args)\n  return thisWorld.get(recv, sel).apply(recv, args)\n}\n\n// New\n\nFunction.prototype.worldsNew = function() {\n  var r = {parent: thisWorld.get(this, \"prototype\")}\n  this.apply(r, arguments)\n  return r\n}\n\n// instanceof\n\ninstanceOf = function(x, C) {\n  var p = x.parent, Cp = thisWorld.get(C, \"prototype\")\n  while (p != undefined) {\n    if (p == Cp)\n      return true\n    p = p.parent\n  }\n  return false\n}\n\n// Some globals, etc.\n\nwObject  = function() { }\nthisScope.decl(\"Object\",  wObject)\nthisWorld.set(wObject, \"prototype\", Object.prototype)\nthisWorld.set(Object.prototype, \"hasOwn\", function(p) { return thisWorld.has(this, p) })\nthisWorld.set(Object.prototype, \"toString\", function() { return \"\" + this })\n\nthisWorld.set(worldProto, \"sprout\",   function() { return this.sprout()                   })\nthisWorld.set(worldProto, \"commit\",   function() { return this.commit()                   })\nthisWorld.set(worldProto, \"toString\", function() { return \"[World \" + this.getTag() + \"]\" })\n\nwWorld    = function() { }; thisScope.decl(\"World\",    wWorld);    thisWorld.set(wWorld,    \"prototype\", worldProto)\nwBoolean  = function() { }; thisScope.decl(\"Boolean\",  wBoolean);  thisWorld.set(wBoolean,  \"prototype\", {parent: Object.prototype})\nwNumber   = function() { }; thisScope.decl(\"Number\",   wNumber);   thisWorld.set(wNumber,   \"prototype\", {parent: Object.prototype})\nwString   = function() { }; thisScope.decl(\"String\",   wString);   thisWorld.set(wString,   \"prototype\", {parent: Object.prototype})\nwArray    = function() { }; thisScope.decl(\"Array\",    wArray);    thisWorld.set(wArray,    \"prototype\", {parent: Object.prototype})\nwFunction = function() { }; thisScope.decl(\"Function\", wFunction); thisWorld.set(wFunction, \"prototype\", {parent: Object.prototype})\n\nBoolean.prototype.parent   = thisWorld.get(wBoolean,   \"prototype\")\nNumber.prototype.parent    = thisWorld.get(wNumber,    \"prototype\")\nString.prototype.parent    = thisWorld.get(wString,    \"prototype\")\nFunction.prototype.parent  = thisWorld.get(wFunction,  \"prototype\")\n// Don't need to do this for Array because Worlds/JS arrays are not JS arrays\n\nthisWorld.set(wString, \"fromCharCode\", function(x) { return String.fromCharCode(x) })\nthisWorld.set(String.prototype.parent, \"charCodeAt\", function(x) { return this.charCodeAt(x) })\n\nthisWorld.set(Function.prototype.parent, \"apply\", function(recv, args) {\n  var jsArgs\n  if (args && thisWorld.get(args, \"length\") > 0) {\n    jsArgs = []\n    for (var idx = 0; idx < thisWorld.get(args, \"length\"); idx++)\n      jsArgs.push(thisWorld.get(args, idx))\n  }\n  return this.apply(recv, jsArgs)\n})\nthisWorld.set(Function.prototype.parent, \"call\", function(recv) {\n  var jsArgs = []\n  for (var idx = 1; idx < arguments.length; idx++)\n    jsArgs.push(arguments[idx])\n  return this.apply(recv, jsArgs)\n})\n\nthisScope.decl(\"null\",      null)\nthisScope.decl(\"undefined\", undefined)\nthisScope.decl(\"true\",      true)\nthisScope.decl(\"false\",     false)\n\nthisScope.decl(\"jsEval\",  function(s) { return eval(thisWorld.get(s, \"toString\").call(s))    })\nthisScope.decl(\"print\",   function(s) { print(thisWorld.get(s, \"toString\").call(s))          })\nthisScope.decl(\"alert\",   function(s) { alert(thisWorld.get(s, \"toString\").call(s))          })\nthisScope.decl(\"prompt\",  function(s) { return prompt(thisWorld.get(s, \"toString\").call(s))  })\nthisScope.decl(\"confirm\", function(s) { return confirm(thisWorld.get(s, \"toString\").call(s)) })\n\nthisScope.decl(\"parseInt\",   function(s) { return parseInt(s)   })\nthisScope.decl(\"parseFloat\", function(s) { return parseFloat(s) })\n\nWorldsConsole = {}\nthisScope.decl(\"console\", WorldsConsole)\nthisWorld.set(WorldsConsole, \"log\", function(s) { Transcript.show(thisWorld.get(s, \"toString\").apply(s)) })\n\nArray.prototype.toWJSArray = function() {\n  var r = wArray.worldsNew()\n  for (var idx = 0; idx < this.length; idx++)\n    thisWorld.set(r, idx, this[idx])\n  thisWorld.set(r, \"length\", this.length)\n  return r\n}\nObject.prototype.toWJSObject = function() {\n  var r = wObject.worldsNew()\n  for (var p in this)\n    if (this.hasOwnProperty(p))\n      thisWorld.set(r, p, this[p])\n  return r\n}\n\n"]}